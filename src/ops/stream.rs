use rand::seq::IndexedRandom;
use teloxide::{
    Bot,
    payloads::SetMessageReactionSetters,
    prelude::Requester,
    sugar::request::RequestReplyExt,
    types::{Me, ReactionType, Update, UpdateKind::Message},
};

use crate::ops::error::Error;

fn random_quote() -> String {
    let pool = vec![
        "Ð¢Ñ‹ ÑÐ´Ð¾Ñ…Ð½ÐµÑˆÑŒ Ð² Ð°Ð´Ñƒ ÑƒÑ€Ð¾Ð´",
        "Ð¯ Ð±Ñ‹ Ñ‚ÐµÐ±Ðµ Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð¿Ð¾ Ñ‚Ð²Ð¾ÐµÐ¹ Ð»Ñ‹ÑÐ¸Ð½Ðµ Ð²Ð¾Ð½ÑŽÑ‡ÐµÐ¹ c Ð¿Ñ‹Ñ€Ñƒ Ð²ÑŠÐµÐ±Ð°Ð»",
        "Ð”Ð° Ð´Ð° Ð½ÐµÑ‚ Ð½ÐµÑ‚, Ð¿Ð¾Ð´ÑƒÐ¼Ð°Ñ‚ÑŒ Ð´Ð¾ Ð·Ð°Ð²Ñ‚Ñ€Ð° ÐµÑÑ‚ÑŒ Ð²Ñ€ÐµÐ¼Ñ Ñƒ Ñ‚ÐµÐ±Ñ",
        "ÐœÑ‹ Ð½Ð° ÑÐ²Ð¾ Ð¿Ð¾Ð¹Ð´ÐµÐ¼ Ñ€Ð¾Ð´Ð¸Ð½Ñƒ Ð·Ð°Ñ‰Ð¸Ñ‰Ð°Ñ‚ÑŒ ?",
        "ÑÐ»Ð°Ð²Ð° Ð±Ð¾Ð³Ñƒ Ð¼Ñ‹ Ð¶Ð¸Ð²ÐµÐ¼ Ð² Ñ€Ð¾ÑÑÐ¸Ð¸, Ð° Ð½Ðµ Ð² Ð°Ð¼ÐµÑ€Ð¸ÐºÐµ",
        "Ð”Ð°, Ñ€Ð°ÐºÑƒÑ€Ñ Ð´ÐµÐ»Ð°ÐµÑ‚ Ð²ÐµÑ‰Ð¸, Ð² Ð¶Ð¸Ð·Ð½Ð¸ Ñ‚Ñ‹ Ð±Ñ‹ ÑƒÐ²Ð¸Ð´ÐµÐ», Ð¿Ð¸ÑÐµ Ð½Ðµ Ð¿Ð¾Ð´Ð½ÑÐ»Ð°ÑÑŒ Ð±Ñ‹",
        "Ð”ÐµÐ²ÑƒÑˆÐºÐ° Ð±Ð¾Ñ€Ð¸ÑÐ°",
        "Ñ‚Ñ‹ 1Ñ…1 Ð½Ðµ Ñ…Ð¾Ñ‡ÐµÑˆÑŒ Ð¿Ð¾Ð¹Ñ‚Ð¸ Ð¿Ð¾Ð¿Ð¸Ð·Ð´Ð¸Ñ‚ÑŒÑÑ? Ñ‡Ð¸ÑÑ‚Ð¾ Ð·Ð° Ñ‡ÐµÑÑ‚ÑŒ Ð²Ð»Ð°Ð´Ð¸Ð¼Ð¸Ñ€Ð° Ð¿ÑƒÑ‚Ð¸Ð½Ð°",
        "Ð¯ Ð·Ð° Ð»ÑŽÐ»Ñ ÐºÐµÐ±Ð°Ð± Ð½Ð° Ð¿ÑÑ‚ÑŒÑÐ¾Ñ‚ Ð ÑƒÐ±Ð»ÐµÐ²Ð¾Ð¹ ÐºÑƒÐ¿ÑŽÑ€Ðµ",
        "Ð¯ Ð±Ñ‹ Ð²Ð¼ÐµÑˆÐ°Ð»ÑÑ, Ð½Ð¾ Ð¼Ð½Ðµ Ð²Ð¿Ð½ Ð´Ð¾Ñ€Ð¾Ð¶Ðµ",
        "ÐÐ´ÐµÐºÐ²Ð°Ñ‚Ð½Ñ‹Ð¹ Ñ‡ÐµÐ»Ð¾Ð²ÐµÐº Ñ‚Ð°ÐºÐ¾Ðµ Ñ‡Ð¸Ñ‚Ð°Ñ‚ÑŒ Ð½Ðµ Ð±ÑƒÐ´ÐµÑ‚",
        "ÐÑƒ Ñ Ð¿Ð¾Ð½ÑÐ» Ð³ÑƒÐ»ÑÑˆ Ð³Ð¾Ð²Ð½Ð¾ Ð¿Ð¾Ñ‚Ð¾Ð¼Ñƒ Ñ‡Ñ‚Ð¾ Ð½Ð°Ð¿Ð¾Ð¼Ð¸Ð½Ð°ÐµÑ‚ ÑÑÑÑ€",
        "Ð¯ Ð±Ñ€Ð°Ð» Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÐµÐµ Ð²Ñ€ÐµÐ¼Ñ Ð¿Ð¸ÐºÐ½Ð¸Ðº Ð¸ Ñ‚Ð°Ð¼ Ð±Ñ‹Ð»Ð¾ 2 Ñ€Ð°Ð·Ð½Ð¾Ð²Ð¸Ð´Ð½Ð¾ÑÑ‚Ð¸, Ð¾Ð´Ð¸Ð½ Ð¾Ð±Ñ‹Ñ‡Ð½Ñ‹Ð¹, Ð´Ñ€ÑƒÐ³Ð¾Ð¹ ÐºÐ°ÐºÐ¾Ð¹-Ñ‚Ð¾ Ð½ÐµÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ñ‹Ð¹, Ñ Ð²ÑÐµÐ³Ð´Ð° Ð±Ñ€Ð°Ð» Ð´ÐµÑ„Ð¾Ð»Ñ‚, Ñ€ÐµÑˆÐ¸Ð» Ð¿Ð¾Ð¿Ñ€Ð¾Ð±Ð¾Ð²Ð°Ñ‚ÑŒ ÑÐºÐ·Ð¾Ñ‚Ð¸ÐºÑƒ, Ñ Ð²Ð·ÑÐ», Ð¿Ð¾Ð¿Ñ€Ð¾Ð±Ð¾Ð²Ð°Ð» Ð¸ Ð¿Ñ…ÑƒÐµÐ», Ñ Ñ‚Ð°ÐºÐ¾Ð³Ð¾ Ð³Ð¾Ð²Ð½Ð° Ð½Ðµ Ð¿Ñ€Ð¾Ð±Ð¾Ð²Ð°Ð» Ð½Ð¸ÐºÐ¾Ð³Ð´Ð°, ÑÑ‚Ð¾ Ð²Ð¸Ð´Ð¸Ð¼Ð¾ Ð¾Ñ‚ ÐºÐ°ÐºÐ¾Ð³Ð¾-Ñ‚Ð¾ Ð¼ÐµÑÑ‚Ð½Ð¾Ð³Ð¾ Ð¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´Ð¸Ñ‚ÐµÐ»Ñ",
        "Ð­Ñ‚Ð¾ 90 Ð°Ð¹ÐºÑŒÑŽ ÑŽÐ¼Ð¾Ñ€ Ñ Ð”Ð°ÑƒÐ½",
        "Ð”Ð°, Ð´Ð°Ð²Ð°Ð¹ Ñ Ñ‚Ð¾Ð±Ð¾Ð¹ Ð¿Ð¾Ð´ÐµÑ€ÐµÐ¼ÑÑ, ÐµÑÐ»Ð¸ Ñ Ð¿Ð¾Ð±ÐµÐ¶Ð´Ð°ÑŽ, Ñ Ñ‚ÐµÐ±Ñ Ð¸Ð· ÐºÐ²Ð°Ñ€Ñ‚Ð¸Ñ€Ñ‹ Ð²Ñ‹Ð¿Ð¸ÑÑ‹Ð²Ð°ÑŽ, Ð° ÐµÑÐ»Ð¸ Ñ‚Ñ‹, Ñ Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð·Ð°Ð¿Ð»Ð°Ñ‡Ñƒ Ð¸ Ð´Ð¾Ð¼Ð¾Ð¹ Ð¿Ð¾Ð¹Ð´Ñƒ",
        "ÐœÐ°Ð½Ð¸Ñ„ÐµÑÑ‚ ÐºÑƒÐºÐ¾Ð»Ð´Ð¸ÑÑ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ð¹ Ð¿Ð°Ñ€Ñ‚Ð¸Ð¸. ÐŸÑ€Ð¸Ð½Ñ†Ð¸Ð¿Ñ‹ ÐºÑƒÐºÐ¾Ð»Ð´Ð¸Ð·Ð¼Ð°",
        "Ð ÐÐ‘Ð¾Ñ‚Ð°ÑŽÑ‚ Ñ€Ð°Ð±Ñ‹, Ñ ÑÐ¾Ð·ÐµÑ€Ñ†Ð°Ð»",
        "Ð¸ Ñ‡Ðµ ? Ñ‚ÐµÐ±Ñ Ð½Ð°Ñ…ÑƒÑÑ€Ð¸Ñ‚ÑŒ Ñ‡Ñ‚Ð¾Ð»Ð¸ Ñ‚Ñ‹ Ð¸Ð¼ÐµÐµÑˆÑŒ Ð²Ð²Ð¸Ð´Ñƒ ?",
        "Ð”Ð° Ð¾Ð½ ÑƒÐ¶Ðµ Ð² Ð¾Ð¿ÑƒÑ‰ÐµÐ½ÐºÐµ, Ñ‚Ð°Ð¼ ÐµÐ³Ð¾ Ñ€Ð°Ð·Ð±Ð¸Ñ€Ð°Ñ‚ÑŒ Ð´Ð°Ð¶Ðµ ÑÐ¼Ñ‹ÑÐ»Ð° Ð½ÐµÑ‚, ÐµÐ³Ð¾ ÑÐ¼Ð¾Ñ‚Ñ€ÑÑ‚ ÑƒÐ¶Ðµ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ ÐºÐ¾Ð½Ñ‡ÐµÐ½Ð½Ñ‹Ðµ Ñ„Ñ€Ð¸ÐºÐ¾ Ð·Ð¾Ð¼Ð±Ð¸",
        "Ð¡Ñ‚ÐµÐ¿Ð°Ð½ ÐºÐ°Ðº Ð¾Ð±Ñ‹Ñ‡Ð½Ð¾ Ð¾Ñ‡ÐµÐ½ÑŒ ÑÐ¸Ð»ÑŒÐ½Ð¾ Ð²ÑÐµÑ… Ð·Ð°ÑƒÐ²Ð°Ð¶Ð°Ð» Ð¸ ÑƒÐ±ÐµÐ¶Ð°Ð» Ð´Ð¾Ð¼Ð¾Ð¹",
    ];
    let mut rng = rand::rng();
    match pool.choose(&mut rng) {
        Some(quote) => quote.to_string(),
        None => panic!("Can't find quote"),
    }
}

pub async fn process_stream_msg(bot: Bot, update: Update, _: Me) -> Result<(), Error> {
    match update.kind {
        Message(msg) => match msg.text() {
            Some(_) => {
                let quote = random_quote();
                let _ = bot.send_message(msg.chat.id, quote).reply_to(msg.id).await;
                let _ = bot
                    .set_message_reaction(msg.chat.id, msg.id)
                    .reaction(vec![ReactionType::Emoji {
                        emoji: "ðŸ¤¡".to_string(),
                    }])
                    .await;
                Ok(())
            }
            None => Ok(()),
        },
        _ => Ok(()),
    }
}
